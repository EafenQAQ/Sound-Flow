# 歌单管理器功能说明

## 🎵 功能概述

歌单管理器是一个强大的批量管理工具，允许用户管理自己创建的歌单和歌曲。

## ✨ 主要功能

### 1. 权限控制
- **用户只能管理自己创建的歌单**
- 自动验证用户权限，防止误操作他人歌单
- 未登录用户会收到提示信息

### 2. 批量删除歌单
- ✅ 支持全选/取消全选
- ✅ 批量选择多个歌单
- ✅ 确认对话框防止误删
- ✅ 自动删除关联的封面图片
- ✅ 实时更新选择状态

### 3. 批量删除歌曲
- ✅ 在歌曲管理模态框中操作
- ✅ 支持全选/取消全选歌曲
- ✅ 批量删除选中的歌曲
- ✅ 实时同步歌单数据

### 4. 单个删除功能
- ✅ 删除单个歌单（包括封面图片）
- ✅ 删除单个歌曲
- ✅ 确认对话框防止误操作

## 🛡️ 安全特性

### 权限验证
```javascript
// 权限检查函数
const canManagePlaylist = (playlist) => {
  return user.value && playlist.userId === user.value.uid
}
```

### 数据完整性
- 删除歌单时自动清理 Firebase Storage 中的封面图片
- 使用 Firebase 批量操作确保数据一致性
- 错误处理和回滚机制

## 🎨 用户界面

### 响应式设计
- 移动端：1列网格布局
- 平板端：2列网格布局  
- 桌面端：3列网格布局

### 交互体验
- 渐入动画效果
- 悬停状态反馈
- 加载状态指示器
- 成功/错误消息提示

### 模态框设计
- 批量删除确认对话框
- 歌曲管理器模态框
- 响应式布局适配

## 📱 使用方法

### 访问歌单管理器
1. 登录账户
2. 点击导航栏中的"歌单管理"
3. 或直接访问 `/playlist/manager`

### 批量删除歌单
1. 勾选要删除的歌单
2. 点击"批量删除"按钮
3. 在确认对话框中点击"确认删除"

### 管理歌曲
1. 点击歌单卡片上的"管理歌曲"按钮
2. 在弹出的模态框中选择要删除的歌曲
3. 点击"删除选中"或单个删除按钮

## 🔧 技术实现

### 核心 Composables
- `useDelete.js` - 删除功能封装
- `getCollection.js` - 获取用户歌单
- `useDocument.js` - 更新歌单数据

### 关键功能
```javascript
// 批量删除歌单
const batchDeletePlaylists = async (playlists) => {
  // 1. 删除封面图片
  // 2. 批量删除文档
  // 3. 错误处理
}

// 批量删除歌曲
const batchDeleteSongs = async () => {
  // 1. 权限验证
  // 2. 更新歌单数据
  // 3. 界面同步
}
```

### 状态管理
- 选择状态：`selectedPlaylists`, `selectedSongs`
- 模态框状态：`showBatchDeleteModal`, `showSongManager`
- 加载状态：`deleteLoading`
- 消息提示：`successMessage`

## 🚀 部署说明

### 路由配置
```javascript
{
  path: '/playlist/manager',
  name: 'playlistManager',
  component: () => import('@/views/management/playlistManager.vue'),
  beforeEnter: requireAuth,
}
```

### 导航链接
已在 `NavBar.vue` 中添加"歌单管理"链接

## ⚠️ 注意事项

1. **权限控制**：用户只能删除自己创建的歌单
2. **数据安全**：删除操作不可撤销，请谨慎操作
3. **网络连接**：删除操作需要稳定的网络连接
4. **浏览器兼容**：建议使用现代浏览器以获得最佳体验

## 🐛 错误处理

- 网络错误：显示错误消息并允许重试
- 权限错误：提示用户权限不足
- 数据错误：回滚操作并显示错误信息

## 📊 性能优化

- 懒加载组件
- 批量操作减少网络请求
- 响应式图片加载
- 动画性能优化
